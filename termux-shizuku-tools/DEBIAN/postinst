#!/data/data/com.termux/files/usr/bin/bash

readonly TST_LIB_DIR="/data/data/com.termux/files/usr/libexec/shizuku"
readonly TST_BIN="/data/data/com.termux/files/usr/bin/shizuku"
readonly TST_RISH_DEX="$TST_LIB_DIR/rish_shizuku.dex"


if [ -f "$TST_LIB_DIR/shizuku_lib.sh" ]; then
    source "$TST_LIB_DIR/shizuku_lib.sh"
fi


if [ -f "$TST_LIB_DIR/tst_utils.sh" ]; then
    source "$TST_LIB_DIR/tst_utils.sh"
else
    echo "Error: tst_utils.sh not found in $TST_LIB_DIR"
    exit 1
fi


chmod 755 "$TST_BIN"
[ -f "$TST_RISH_DEX" ] && chmod 444 "$TST_RISH_DEX"

# Симлинк
ln -sf "$TST_BIN" "/data/data/com.termux/files/usr/bin/shk"

case "$1" in
    configure)
       
        CURRENT_VERSION=$(tst_version)
        VERSION_CODE=$(tst_version_code)
        
        if [ -z "$CURRENT_VERSION" ]; then CURRENT_VERSION="unknown"; fi

        if [ -n "$2" ]; then
            echo -e "\nPackage termux-shizuku-tools updated! ($2 -> $CURRENT_VERSION)"
            echo "Use 'shizuku help' for available commands"
        else
            echo -e "\nPackage termux-shizuku-tools $CURRENT_VERSION ($VERSION_CODE) by AlexeiCrystal installed!"
            echo "Use 'shizuku help' for available commands"
        fi
        ;;
esac