#!/data/data/com.termux/files/usr/bin/bash

REINSTALL_MSG="Please reinstall termux-shizuku-tools package"

if [[ ! -f "$PREFIX/libexec/shizuku/shizuku_lib.sh" ]]; then
    echo "Error: File $PREFIX/libexec/shizuku/shizuku_lib.sh not found"
    echo "$REINSTALL_MSG"
    exit 1
fi

source $PREFIX/libexec/shizuku/shizuku_lib.sh

if [[ ! -f "$PREFIX/libexec/shizuku/tst_utils.sh" ]]; then
    echo "Error: File $PREFIX/libexec/shizuku/tst_utils.sh not found"
    echo "$REINSTALL_MSG"
    exit 1
fi

source $PREFIX/libexec/shizuku/tst_utils.sh

if [[ ! -f "$RISH_DEX_PATH" ]]; then
    echo "Error: File $RISH_DEX_PATH not found"
    echo "$REINSTALL_MSG"
    exit 1
fi

case "$1" in
    "" | "--help" | "help" | "h" | "-h")
        show_help
        exit 0
        ;;
    "info" | "i" | "status")
        show_status
        exit 0
        ;;
    "version" | "v")
        show_version
        exit 0
        ;;
    "open" | "o" | "stop" | "s" | "shell" | "sh" | "e" | "execute" | "exec")
        if [[ "$(is_shk_installed)" == "false" ]]; then
            echo "$SHK_NOT_INST_ERR_MSG"
            exit 1
        fi
        
        case "$1" in
            "open" | "o")
                echo "$SHK_LAUNCH_MSG"
                open_shk
                ;;
            "stop" | "s")
                echo "Stopping Shizuku server..."
                stop_shk_server
                ;;
            "shell" | "sh")
                echo "$SHK_I_SH_MSG"
                echo "$SHK_I_SH_EXIT_TIP"
                open_shk_interactive_shell
                ;;
            "e" | "exec" | "execute")
                shift
                execute_shk_command "$@"
                ;;
        esac
        exit 0
        ;;
    *)
        echo "$SHK_UNK_CMD_ERR_MSG $1"
        echo "Use 'shizuku help' for available commands"
        exit 1
        ;;
esac